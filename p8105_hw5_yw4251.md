p8105_hw5_yw4251
================
You Wu
2023-11-12

# Problem 0

``` r
library(tidyverse)
```

    ## ── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
    ## ✔ dplyr     1.1.3     ✔ readr     2.1.4
    ## ✔ forcats   1.0.0     ✔ stringr   1.5.0
    ## ✔ ggplot2   3.4.3     ✔ tibble    3.2.1
    ## ✔ lubridate 1.9.2     ✔ tidyr     1.3.0
    ## ✔ purrr     1.0.2     
    ## ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
    ## ✖ dplyr::filter() masks stats::filter()
    ## ✖ dplyr::lag()    masks stats::lag()
    ## ℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors

``` r
library(purrr)
library(ggridges)
```

# Problem 2

``` r
file_list = list.files(path = "data/",full.names = TRUE)
file_info_df = data.frame(file_name = file_list)

process_file = function(file_path) {
  parts = str_split(basename(file_path), "_|\\.")[[1]]
  arm = parts[1]
  subject_id = parts[2]

  data = read.csv(file_path) 

  data = mutate(data, subject_id = subject_id, arm = arm)

  return(data)
}

all_data = map_df(file_info_df$file_name, process_file)|>
  pivot_longer(
    week_1:week_8,
    names_to="week",
    values_to="outcome",
    names_prefix="week_"
  )

all_data
```

    ## # A tibble: 160 × 4
    ##    subject_id arm   week  outcome
    ##    <chr>      <chr> <chr>   <dbl>
    ##  1 01         con   1        0.2 
    ##  2 01         con   2       -1.31
    ##  3 01         con   3        0.66
    ##  4 01         con   4        1.96
    ##  5 01         con   5        0.23
    ##  6 01         con   6        1.09
    ##  7 01         con   7        0.05
    ##  8 01         con   8        1.94
    ##  9 02         con   1        1.13
    ## 10 02         con   2       -0.88
    ## # ℹ 150 more rows

``` r
ggplot(all_data, aes(x = week, y = outcome, group = subject_id, color = subject_id)) +
  geom_line(alpha=0.6) +
  geom_point(size=1.5)+
  theme_minimal() +
  facet_grid(~arm)+
  labs(
    title = "Observations Over Time by Subject",
    x = "Week",
    y = "Observation Outcome",
    color = "Group"
  ) 
```

![](p8105_hw5_yw4251_files/figure-gfm/unnamed-chunk-2-1.png)<!-- -->

# Problem 3

``` r
set.seed(1)
sim_mean_test <- function(mu,n=30, sigma = 5) {
  sim_data = tibble(
    x=rnorm(n=n, mean=mu, sd = sigma)
  )
  test_result = broom::tidy(t.test(sim_data$x, mu=mu))|>
    select(mu_hat=estimate,p.value)
  return(test_result)
}

sim_results_df_0 =   
  map(1:5000, \(i) sim_mean_test(0)) |> 
  bind_rows()

head(sim_results_df_0)
```

    ## # A tibble: 6 × 2
    ##   mu_hat p.value
    ##    <dbl>   <dbl>
    ## 1  0.412  0.629 
    ## 2  0.664  0.368 
    ## 3  0.551  0.534 
    ## 4  0.567  0.487 
    ## 5 -1.65   0.0599
    ## 6  1.19   0.229

``` r
sim_results_df_1_6 = 
  expand_grid(
    mu = 0:6,
    iter = 1:50
  )|> 
  mutate(
    estimate_df = map(mu, sim_mean_test)
  ) |> 
  unnest(estimate_df)

power_analysis=sim_results_df_1_6|>
  group_by(mu)|>
  summarise(
    power=mean(p.value<0.05),
    avg_mu_hat = mean(mu_hat),
    avg_mu_hat_rejected = mean(mu_hat[p.value < 0.05])
    )
```

``` r
power_analysis|>
  ggplot(aes(x=mu,y=power))+
  geom_point() +
  geom_line() +
  labs(title = "Power vs True Mean", x = "True Mean", y = "Power")
```

![](p8105_hw5_yw4251_files/figure-gfm/unnamed-chunk-4-1.png)<!-- -->
